Threads={}debuglog=false;busyspin=true;Threads_Custom_Alive={}Threads_Custom_Timers={}Threads_Custom_VarTimer={}Threads_Custom_Functions={}Threads_Custom_Once={}Threads_Custom_ActionTables={}local function a(b)return Threads_Custom_ActionTables[b]end;Threads.loop_custom=function()error("Outdated",2)end;Threads.loop2_custom=function(c,d,e,f)if Threads_Custom_Once[c]then return end;if debuglog and not d then print("[BAD Hobbits]Some Threads.loop2 timer is nil on "..GetCurrentResourceName())end;local g=c or tostring(e)local b=d>=0 and d or 0;local h=a(b)if h then if Threads_Custom_Functions[g]then print('[Warning]Threads'..g..' is doubly and replaced')end;Threads_Custom_Alive[g]=true;Threads_Custom_Functions[g]=e;Threads_Custom_Timers[g]=b;table.insert(Threads_Custom_ActionTables[b],g)else if Threads_Custom_Functions[g]then print('[Warning]Threads'..g..' is doubly and replaced')end;Threads_Custom_Alive[g]=true;Threads_Custom_Functions[g]=e;Threads_Custom_Timers[g]=b;Threads_Custom_ActionTables[b]={}local i=Threads_Custom_ActionTables[b]local j=b;table.insert(Threads_Custom_ActionTables[b],g)CreateThread(function()while true do if#i==0 then return end;for k=1,#i do CreateThread(function()local l=i[k]if Threads_Custom_Alive[l]and Threads_Custom_Functions[l]and Threads_Custom_Timers[l]==b then local m={setter=setmetatable({},{__call=function(n,o)Threads.SetLoopCustom(f,o)end}),getter=function(n,o)return Threads.GetLoopCustom(f)end}local p=m;Threads_Custom_Functions[l](f and p,l,#i or l,#i)else if i and i[k]then table.remove(i,k)if#i==0 then Threads.KillLoopCustom(g,b)return end end end end)end;if f and Threads_Custom_VarTimer[f]then j=Threads_Custom_VarTimer[f]end;Wait(j>0 and j or 0)end;return end)end end;Threads.CreateLoopCustom=function(...)local q={...}local r=#q;local s,t,g,u;if r==4 then g=q[1]u=q[2]s=q[3]t=q[4]elseif r==3 then g=q[1]u=q[2]s=q[3]elseif r==2 then g=GetCurrentResourceName()u=q[1]s=q[2]elseif r==1 then g=GetCurrentResourceName()u=0;s=q[1]end;if not t then local v=tostring(debug.getinfo(2,'S').source)..'line'..tostring(debug.getinfo(2).currentline)t=v end;Threads_Custom_VarTimer[t]=u;if debuglog then print("Linked VarName '"..t.."' to a Custom Timer")print('threads:CreateLoopCustom:Varname:'..t,"actionname: "..g)end;Threads.loop2_custom(g,u,s,t)end;Threads.CreateLoopOnceCustom=function(...)local q={...}local r=#q;local s,t,g,u;if r==4 then g=q[1]u=q[2]s=q[3]t=q[4]elseif r==3 then g=q[1]u=q[2]s=q[3]elseif r==2 then g=GetCurrentResourceName()u=q[1]s=q[2]elseif r==1 then g=GetCurrentResourceName()u=0;s=q[1]end;if not Threads_Custom_Once[g]then if not t then local v=tostring(debug.getinfo(2,'S').source)..'line'..tostring(debug.getinfo(2).currentline)t=v end;Threads_Custom_VarTimer[t]=u;if debuglog then print("Linked VarName '"..t.."' to a Custom Timer")print('threads:CreateLoopOnceCustom:Varname:'..t,"actionname: "..g)end;if debuglog then print('threads:CreateLoopOnce:CreateThread:'..u,g)end;Threads.loop2_custom(g,u,s,t)Threads_Custom_Once[g]=true end end;Threads.CreateLoopCustomOnce=Threads.CreateLoopOnceCustom;Threads.GetLoopCustom=function(t)if not Threads_Custom_VarTimer[t]then error("VarTimer not found.Make sure set varname in the last of Threads.CreateLoopCustom(actionname,defaulttimer,func,varname)",2)end;return Threads_Custom_VarTimer[t]end;Threads.SetLoopCustom=function(t,w)if not Threads_Custom_VarTimer[t]then error("VarTimer not found.Make sure set varname in the last of Threads.CreateLoopCustom(actionname,defaulttimer,func,varname)",2)end;Threads_Custom_VarTimer[t]=w end;Threads.KillLoopCustom=function(g,b)Threads_Custom_Alive[g]=nil;Threads_Custom_Functions[g]=nil;Threads_Custom_Timers[g]=nil;Threads_Custom_ActionTables[b]=nil;Threads_Custom_Once[g]=nil;if debuglog then print('threads:KillLoopCustom:'..g,b)end end;Threads.KillActionOfLoopCustom=function(g)for b,c in pairs(Threads_Custom_ActionTables)do if c==g then for k=1,#Threads_Custom_ActionTables[b]do if Threads_Custom_ActionTables[b][k]==g then table.remove(Threads_Custom_ActionTables[b],k)if#Threads_Custom_ActionTables[b]==0 then Threads.KillLoopCustom(g,b)return end end end end end;Threads_Custom_Alive[g]=false;Threads_Custom_Once[g]=false;Threads_Custom_Functions[g]=nil;if debuglog then print('threads:KillActionOfLoopCustom:'..g)end end;Threads.IsActionOfLoopAliveCustom=function(g)return Threads_Custom_Alive[g]and true or false end;Threads.IsLoopAliveCustom=function(g)return Threads_Custom_Functions[g]and true or false end;if debuglog then local x="threads"CreateThread(function()if IsDuplicityVersion()then if GetCurrentResourceName()~=x then print('\x1B[32m[server-utils]\x1B[0m'..x..' is used on '..GetCurrentResourceName().." \n\x1B[32m[\x1B[33m"..x.."\x1B[32m]\x1B[33m"..GetResourcePath(GetCurrentResourceName())..'\x1B[0m')end;RegisterServerEvent(x..':log')AddEventHandler(x..':log',function(y,z)print(y.." player:"..GetPlayerName(source).." \n\x1B[32m[\x1B[33m"..x.."\x1B[32m]\x1B[33m"..GetResourcePath(z)..'\x1B[0m')end)else if GetCurrentResourceName()~=x then TriggerServerEvent(x..':log','\x1B[32m[client-utils]\x1B[0m'..x..'" is used on '..GetCurrentResourceName(),GetCurrentResourceName())end end end)end;Threads_OnceThread={}Threads.CreateThreadOnce=function(A)if Threads_OnceThread[tostring(A)]then return end;Threads_OnceThread[tostring(A)]=true;CreateThread(A)end;Threads.ClearThreadOnce=function(g)Threads_OnceThread[g]=nil end;Threads.CreateLoad=function(B,C,D,E)if debuglog then print('threads:CreateLoad:'..B)end;local F=C(B)local G=GetGameTimer()local H=false;local I=nil;while true do if not D(B)and GetGameTimer()>G+1000 then if busyspin then AddTextEntry("TEXT_LOAD","Loading...(by threads)")BeginTextCommandBusyspinnerOn("TEXT_LOAD")EndTextCommandBusyspinnerOn(4)end end;if not D(B)and GetGameTimer()>G+5000 then H=true end;if HasScaleformMovieLoaded~=D then if D(B)then I=B end else local F=C(B)if D(F)then I=F end end;if H then break elseif I then break end;Wait(33)end;if busyspin then BusyspinnerOff()end;if H then if debuglog then print('threads:CreateLoad:'..B.."Loading Failed")end elseif I then E(I)end end;local function J(b)return Threads_ActionTables[b]end;Threads_Alive={}Threads_Timers={}Threads_Functions={}Threads_Once={}Threads_ActionTables={}Threads.loop=function()error("Outdated",2)end;Threads.loop2=function(c,d,e)if Threads_Once[c]then return end;if debuglog and not d then print("[BAD Hobbits]Some Threads.loop2 timer is nil on "..GetCurrentResourceName())end;local g=c or tostring(e)local b=d>=0 and d or 0;local h=J(b)if h then if Threads_Functions[g]then print('[Warning]Threads'..g..' is doubly and replaced')end;Threads_Alive[g]=true;Threads_Functions[g]=e;Threads_Timers[g]=b;table.insert(Threads_ActionTables[b],g)else if Threads_Functions[g]then print('[Warning]Threads'..g..' is doubly and replaced')end;Threads_Alive[g]=true;Threads_Functions[g]=e;Threads_Timers[g]=b;Threads_ActionTables[b]={}local i=Threads_ActionTables[b]local j=b;table.insert(Threads_ActionTables[b],g)CreateThread(function()while true do if#i==0 then return end;for k=1,#i do CreateThread(function()local l=i[k]if Threads_Alive[l]and Threads_Functions[l]and Threads_Timers[l]==b then Threads_Functions[l](l,#i)else if i and i[k]then table.remove(i,k)if#i==0 then Threads.KillLoop(g,b)return end end end end)end;Wait(j)end;return end)end end;Threads.CreateLoop=function(...)local q={...}local r=#q;local s,b,g;if r==3 then g=q[1]b=q[2]s=q[3]elseif r==2 then g=GetCurrentResourceName()b=q[1]s=q[2]elseif r==1 then g=GetCurrentResourceName()b=0;s=q[1]end;if debuglog then print('threads:CreateLoop:CreateThread:'..b,g)end;Threads.loop2(g,b,s)end;Threads.CreateLoopOnce=function(...)local q={...}local r=#q;local s,b,g;if r==3 then g=q[1]b=q[2]s=q[3]elseif r==2 then g=GetCurrentResourceName()b=q[1]s=q[2]elseif r==1 then g=GetCurrentResourceName()b=0;s=q[1]end;if not Threads_Once[g]then if debuglog then print('threads:CreateLoopOnce:CreateThread:'..b,g)end;Threads.loop2(g,b,s)Threads_Once[g]=true end end;Threads.IsActionOfLoopAlive=function(g)return Threads_Alive[g]and true or false end;Threads.IsLoopAlive=function(g)return Threads_Functions[g]and true or false end;Threads.KillLoop=function(g,b)Threads_Alive[g]=nil;Threads_Functions[g]=nil;Threads_Timers[g]=nil;Threads_ActionTables[b]=nil;Threads_Once[g]=nil;if debuglog then print('threads:KillLoop:'..g,b)end end;Threads.KillActionOfLoop=function(g)for b,c in pairs(Threads_ActionTables)do if c==g then for k=1,#Threads_ActionTables[b]do if Threads_ActionTables[b][k]==g then table.remove(Threads_ActionTables[b],k)if#Threads_ActionTables[b]==0 then Threads.KillLoop(g,b)return end end end end end;Threads_Alive[g]=nil;Threads_Once[g]=nil;Threads_Functions[g]=nil;if debuglog then print('threads:KillLoop:'..g)end end